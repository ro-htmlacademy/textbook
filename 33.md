# Пояснение к заданию

При освоении этого раздела учебника важно понимать принцип: вывод **любых**, которые не предполагают наличие HTML, должен быть экранирован. 
Без исключений и рассуждений вида "а вот те данные у нас безопасные, а эти в общем неважно". ВСЕ данные опасны и ВСЕ данные надо корректно форматировать перед выводом.

По сути оператор вывода в шаблоне должен на автомате включать форматирование. Во всех современных шаблонизаторах такой режим используется по умолчанию - оператор вывода безусловно экранирует выводимые данные. А для того чтобы вывести как есть - надо это специально указывать. 
Здесь шаблонизатор игрушечный, но принцип должен соблюдаться тот же самый.  Без каких-либо попыток как-то автоматизировать, упростить или схалтурить. Просто тупо автомат - выводим данные в HTML? Форматируем для HTML. Точка. 
Тот же самый принцип в дальнейшем будет применяться, кстати, и для SQL.

Для того чтобы упростить форматирование вывода, обычно пишется функция-обертка для htmlspecialchars, с как можно более коротким названием.  Это тот редкий случай, когда можно сделать исключение из строгого правила что название функции должно четко и однозначно отражать её действие. 
Также необходимо добавить к вызову htmlspecialchars флаг ENT_QUOTES, для надежности.

# Функция include_template()

Данное исправление относится не к тексту учебника а к функции `include_template()`, которая используется в задании

В этой функции есть очень плохой код.  
Который наглядно демонстрирует разницу между ученическим и профессиональным подходом к программированию (разница заключается в том, что ученический код пишется всегда из расчета что всё всегда работает и никогда не учитывает ситуации, когда что-то может пойти не так).

Вот эти строки необходимо удалить из кода функции:

    if (!is_readable($name)) {
        return $result;
    }
    
единственное, что этот код делает - он **подавляет сообщение об ошибке**.

В случае, если РНР по какой-то причине не сможет прочитать файл шаблона (например если в имени была допущена опечатка), то функция **молча вернет пустоту**   
И в этом случае у программиста может уйти очень большое количество времени на то чтобы чтобы понять почему код не работает. Поскольку будет даже непонятно - в каком конкретно месте кода произошла проблема.

Такое заметание мусора под ковер - это просто огромное западло для программиста.    
Ошибки никогда нельзя подавлять.

Если этот код убрать, то в случае проблем с файлом РНР выдаст подробное объяснение: по какой причине он не может быть прочитан. 
С помощью которого проблему можно будет легко решить. А, главное - сразу увидеть, в каком месте кода она возникла. 

В итоге, поскольку переменная $result нам становится не нужна, и чтобы убрать масло масляное в return, то функцию можно переписать вот так:

    function include_template($name, array $data = [])
    {
        $name = __DIR__.'/templates/' . $name;

        ob_start();
        extract($data);
        require $name;

        return ob_get_clean();
    }

# Указание путей к файлам

Это обширная тема, но в сухом остатке там остаётся простое эмпирическое правило: **всегда использовать абсолютные пути**. Хотя бы достраивая путь до текущего файла с помощью константы `__DIR__`, как это показано в примере выше.
То есть при любых операциях с файлами - чтении, копировании, require и прочем - всегда указывать абсолютный путь. Это позволит избежать множества ошибок в будущем. 

# Мелкие исправления

1. Не рекомендуется использовать оператор print. Это выглядит старомодным. Лучше писать echo
2. Для языковых конструкций, таких как echo, print, require и пр. **скобки не нужны.** Соответственно, писать их не надо.

# Рефакторинг

После выполнения нескольких заданий станет видно, что завершающий код любого скрипта дублируется процентов на 80: в каждом мы два раза вызываем include_template(), передавая туда наполовину один и тот же набор данных. Это явный киндидат на рефакторинг, можно написать функцию, которая принимает необходимые аргументы, и внутри себя выполняет вызовы include_template() и вывод HTML

> **Важно!** Написание этой функции будет представлять из себя отдельную, дополнительную задачу, в рамках задачи **8.7. Завершаем работу над проектом**.  Ни в коем случае нельзя применять её с самого начала. Любой рефакторинг должен происходить только после того, как станет очевидна его необходимость. Выполнение этой задачи не является обязательным, при желании её можно пропустить. 
